<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>What2Cook — Find recipes from your ingredients</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/css/custom.css">
</head>

<body class="bg-light">
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
    <div class="container">
      <a class="navbar-brand" href="/">What2Cook</a>
    </div>
  </nav>

  <main class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">

        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title">Enter ingredients you have</h5>
            <p class="card-text">Separate ingredients by comma or newline. Example: <code>egg, milk, flour</code></p>

            <form id="search-form" class="mb-3" method="post" action="/">
              <div class="mb-2">
                <textarea id="ingredients-input" name="ingredients" class="form-control" rows="3" placeholder="e.g. egg, milk, flour"></textarea>
              </div>
              <div class="d-flex gap-2">
                <button id="search-btn" type="submit" class="btn btn-primary">Search</button>
                <button id="clear-btn" type="button" class="btn btn-outline-secondary">Clear</button>
                <div id="spinner" class="spinner-border text-primary ms-auto" role="status" style="display:none">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
            </form>

            <div id="alerts"></div>
          </div>
        </div>

        <div id="results" class="row g-3">
          {% if recipes is not defined %}
            <div class="col-12">
              <div class="alert alert-info">No search performed yet. Use the form above or open <a href="/docs">API docs</a>.</div>
            </div>
          {% elif recipes|length == 0 %}
            <div class="col-12">
              <div class="alert alert-warning">No recipes found for your ingredients.</div>
            </div>
          {% else %}
            {% for r in recipes %}
              <div class="col-12">
                <div class="card shadow-sm">
                  <div class="row g-0">
                    <div class="col-md-4">
                      <a href="{{ r.image_url or r.image_meta.file_url or '#' }}" target="_blank" rel="noopener noreferrer">
                        <img
                          src="{{ r.thumbnail_url or r.image_url or r.image_meta.file_url or '/static/img/placeholder.png' }}"
                          alt="{{ r.title | e }}"
                          class="img-fluid rounded-start w-100"
                          loading="lazy"
                          decoding="async"
                          onerror="this.onerror=null;this.src='/static/img/placeholder.png';"
                          style="height:220px; object-fit:cover;"
                          width="320"
                          height="220"
                        />
                      </a>

                      {% if r.image_meta %}
                        <div class="p-2 small text-muted">
                          {% if r.image_meta.page_url %}
                            <a href="{{ r.image_meta.page_url }}" target="_blank" rel="noopener noreferrer">{{ (r.image_meta.title or 'Source') | e }}</a>
                          {% endif %}
                          {% if r.image_meta.author %}
                            by {{ r.image_meta.author | e }}
                          {% endif %}
                          {% if r.image_meta.license_url %}
                            — <a href="{{ r.image_meta.license_url }}" target="_blank" rel="license noopener noreferrer">{{ r.image_meta.license or 'license' }}</a>
                          {% elif r.image_meta.license %}
                            — {{ r.image_meta.license | e }}
                          {% endif %}
                        </div>
                      {% endif %}
                    </div>

                    <div class="col-md-8">
                      <div class="card-body">
                        <h5 class="card-title mb-1">{{ r.title | e }}</h5>
                        <div class="text-muted small mb-2">
                          {% if r.score is defined %}Score: {{ (r.score * 100) | round(0) }}% —{% endif %}
                          have {{ r.match_count | default(0) }}/{{ (r.ingredients | length) | default(0) }}
                        </div>

                        <p class="mb-2 text-truncate" style="max-width:100%;">{{ (r.instructions[:240] ~ '...') if r.instructions and r.instructions|length > 240 else (r.instructions or '') }}</p>

                        <p class="mb-1"><strong>Ingredients:</strong> {{ (r.ingredients | join(', ')) | e }}</p>

                        <div class="mt-2">
                          <a href="{{ r.image_url or r.image_meta.file_url or '#' }}" class="btn btn-outline-secondary btn-sm" target="_blank" rel="noopener noreferrer">View image</a>
                          {% if r.source %}
                            <span class="ms-2 text-muted small">Source: {{ r.source | e }}</span>
                          {% endif %}
                          {% if r.prep_minutes %}
                            <span class="ms-2 text-muted small">Prep: {{ r.prep_minutes }} min</span>
                          {% endif %}
                          {% if r.servings %}
                            <span class="ms-2 text-muted small">Serves: {{ r.servings }}</span>
                          {% endif %}
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>

      </div>
    </div>
  </main>

  <footer class="text-center mt-5 mb-4 text-muted small">
     • What2Cook
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="/static/js/search.js"></script>
</body>
</html>
