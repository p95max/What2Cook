{% extends "base.html" %}

{% block title %}{{ recipe.title | e }} — What2Cook{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10">
    <div class="card mb-4">
      <div class="row g-0">
        <div class="col-md-5">
          <img src="{{ recipe.image_url or (recipe.image_meta.file_url if recipe.image_meta else request.url_for('static', path='img/placeholder.png')) }}"
               alt="{{ recipe.title|e }}"
               class="img-fluid w-100"
               style="object-fit:cover; max-height:420px;">
          {% if recipe.image_meta %}
            <div class="small text-muted mt-2">
              {% if recipe.image_meta.author %}Photo: {{ recipe.image_meta.author|e }}{% endif %}
              {% if recipe.image_meta.license_url %} — <a href="{{ recipe.image_meta.license_url }}" target="_blank">license</a>{% endif %}
              {% if recipe.image_meta.page_url %} — <a href="{{ recipe.image_meta.page_url }}" target="_blank">source</a>{% endif %}
            </div>
          {% endif %}
        </div>

        <div class="col-md-7">
          <div class="card-body">
            <h2 class="card-title d-flex align-items-center justify-content-between">
              <span>{{ recipe.title | e }}</span>

            </h2>

            <p class="text-muted mb-2">
              <strong>Prep:</strong> {{ recipe.prep_minutes or '—' }} min &nbsp; • &nbsp;
              <strong>Serves:</strong> {{ recipe.servings or '—' }}
            </p>

            <h5>Ingredients</h5>
            <ul>
              {% for ing in recipe.ingredients %}
                <li>{{ ing | e }}</li>
              {% endfor %}
            </ul>

            <h5>Instructions</h5>
            <p style="white-space:pre-line;">{{ recipe.instructions or '-' }}</p>

                    <!--buttons-->
            <div class="mt-3 d-flex gap-2 align-items-center">
              <button type="button" class="btn btn-outline-secondary btn-sm" onclick="history.back()">Back</button>

        <button
          type="button"
          class="btn btn-sm btn-outline-primary like-btn d-inline-flex align-items-center gap-2"
          data-like="{{ recipe.id }}"
          aria-pressed="false"
          title="Like / Unlike"
        >
          <i class="bi bi-heart" aria-hidden="true"></i>
          <span class="like-label">Like</span>
          <small id="likes-count-{{ recipe.id }}" class="text-muted ms-1" aria-live="polite">—</small>
        </button>


              <button
                type="button"
                class="btn btn-sm btn-outline-success bookmark-btn"
                data-bookmark="{{ recipe.id }}"
                aria-pressed="false"
                title="Bookmark / Remove bookmark">
                <i class="bi bi-bookmark"></i>
                <span class="bookmark-label ms-1">Save</span>
              </button>

            </div>

          </div>
        </div>

      </div>
    </div>
  </div>
</div>

{% block scripts %}
{{ super() }}
<script>
  document.querySelectorAll('.like-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      btn.classList.toggle('liked');
    });
  });
  document.querySelectorAll('.bookmark-btn').forEach(btn => {
    btn.addEventListener('click', () => btn.classList.toggle('bookmarked'));
  });
</script>
{% endblock %}

{% endblock %}
